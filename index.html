<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-translate-key="pageTitle">Professional Invoice Generator</title>

  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js" defer></script>

  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Styles -->
  <style>
    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f7f7f7;
      --bg-panel: #ffffff;
      --text-primary: #111827;
      --text-secondary: #6b7280;
      --border-color: #e5e7eb;
      --shadow-color: rgba(0, 0, 0, 0.05);
      --accent-color: #0c0a09;
      --accent-hover: #404040;
      --accent-light: rgba(12, 10, 9, 0.08);
      --danger-color: #dc2626;
    }

    [data-theme="dark"] {
      --bg-primary: #111827;
      --bg-secondary: #1f2937;
      --bg-panel: #111827;
      --text-primary: #f9fafb;
      --text-secondary: #9ca3af;
      --border-color: #374151;
      --shadow-color: rgba(0, 0, 0, 0.25);
      --accent-color: #f9fafb;
      --accent-hover: #d1d5db;
      --accent-light: rgba(249, 250, 251, 0.08);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 14px; scroll-behavior: smooth; }
    body {
      font-family: "Inter", sans-serif;
      background: var(--bg-secondary);
      color: var(--text-primary);
      transition: background 0.15s, color 0.15s;
      line-height: 1.4;
    }

    /* Action bar */
    .action-bar {
      position: sticky; top: 0; z-index: 100;
      display: flex; justify-content: space-between; align-items: center;
      height: 52px; padding: 0 1rem;
      background: var(--bg-panel);
      border-bottom: 1px solid var(--border-color);
      box-shadow: 0 2px 6px var(--shadow-color);
    }
    .action-group { display: flex; align-items: center; gap: 0.6rem; }
    button, select {
      font-family: inherit; font-size: 0.88rem; border: none; cursor: pointer;
    }
    .btn { border-radius: 6px; padding: 0.45rem 0.8rem; font-weight: 600; transition: background 0.12s; }
    .btn-main { background: var(--accent-color); color: var(--bg-primary); }
    .btn-main:hover { background: var(--accent-hover); }
    .btn-secondary { background: var(--bg-secondary); border: 1px solid var(--border-color); }
    .btn-secondary:hover { border-color: var(--text-primary); }
    .btn-icon { background: none; padding: 0.3rem; font-size: 1.1rem; color: var(--text-secondary); }
    .btn-icon:hover { color: var(--text-primary); }

    /* Layout */
    .app-container { display: grid; grid-template-columns: 1fr 1.2fr; height: calc(100vh - 52px); }
    .panel { overflow-y: auto; }
    .panel-form { background: var(--bg-panel); border-right: 1px solid var(--border-color); padding: 1rem; }
    .panel-preview { padding: 1rem; }

    /* Form */
    details.form-block { border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); margin-bottom: 0.9rem; }
    details.form-block summary { padding: 0.55rem 0.8rem; font-weight: 600; cursor: pointer; list-style: none; }
    details.form-block summary::after { content: "‚ñ∂"; float: right; font-size: 0.65rem; transition: transform 0.2s; }
    details.form-block[open] summary::after { transform: rotate(90deg); }
    .form-inner { padding: 0.6rem 0.8rem 0.9rem; }
    .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.7rem; }
    .form-group { display: flex; flex-direction: column; gap: 0.22rem; }
    label { font-size: 0.75rem; color: var(--text-secondary); }
    input, textarea, select { padding: 0.5rem 0.6rem; border: 1px solid var(--border-color); border-radius: 5px; background: var(--bg-primary); color: var(--text-primary); font-size: 0.85rem; }
    input:focus, textarea:focus, select:focus { border-color: var(--accent-color); box-shadow: 0 0 0 2px var(--accent-light); outline: none; }
    input.invalid { border-color: var(--danger-color); }
    textarea { resize: vertical; min-height: 64px; }

    /* Items */
    #items-header, .item-row { display: grid; grid-template-columns: 4fr 1fr 1.2fr auto; gap: 0.4rem; align-items: center; }
    #items-header { margin-bottom: 0.35rem; }
    #items-header label { font-size: 0.68rem; text-transform: uppercase; color: var(--text-secondary); }
    .item-row input { padding: 0.4rem 0.45rem; font-size: 0.8rem; }
    .btn-add-item { width: 100%; padding: 0.55rem; border: 1px dashed var(--border-color); margin-top: 0.6rem; background: none; color: var(--text-secondary); border-radius: 6px; }
    .btn-add-item:hover { background: var(--bg-secondary); color: var(--accent-color); border-color: var(--accent-color); }
    .btn-remove-item { background: none; border: none; font-size: 1rem; color: var(--text-secondary); cursor: pointer; }
    .btn-remove-item:hover { color: var(--danger-color); }

    /* Preview */
    .preview-wrapper { max-width: 820px; margin: 0 auto; background: #ffffff; padding: 2rem; border-radius: 6px; box-shadow: 0 4px 16px var(--shadow-color); }

    /* Footer */
    .app-footer { text-align: center; font-size: 0.8rem; color: var(--text-secondary); margin-top: 1.2rem; }
    .app-footer a { color: inherit; text-decoration: none; }
    .app-footer a:hover { text-decoration: underline; }

    /* Mobile */
    @media (max-width: 900px) {
      .app-container { grid-template-columns: 1fr; }
      .panel-preview { display: none; }
      .panel-preview.visible { display: block; position: fixed; inset: 0; background: var(--bg-secondary); overflow-y: auto; z-index: 200; padding: 1rem; }
    }

    /* Loading */
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .loading { position: relative; color: transparent !important; }
    .loading::after { content: ""; position: absolute; inset: 0; width: 16px; height: 16px; margin: auto; border: 3px solid rgba(128, 128, 128, 0.3); border-top-color: var(--text-primary); border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <!-- Action bar -->
  <header class="action-bar">
    <div class="action-group">
      <button class="btn btn-main" id="downloadBtn" data-translate-key="downloadPDF">Download PDF</button>
      <button class="btn btn-secondary" id="printBtn" data-translate-key="printPDF">Print</button>
    </div>
    <div class="action-group">
      <button class="btn btn-secondary btn-show-preview" id="showPreviewBtn" style="display:none">üëÅÔ∏è</button>
      <select id="languageSelector"></select>
      <button class="btn btn-icon" id="resetBtn" title="Reset">üîÑ</button>
      <button class="btn btn-icon" id="themeToggle" title="Toggle theme">üåô</button>
    </div>
  </header>

  <main class="app-container">
    <!-- Form panel -->
    <aside class="panel panel-form">
      <form id="invoiceForm" novalidate>
        <!-- Company -->
        <details class="form-block" open>
          <summary data-translate-key="companySectionTitle">Your Company</summary>
          <div class="form-inner">
            <div class="grid-2">
              <div class="form-group">
                <label data-translate-key="companyNameLabel" for="companyName">Company Name *</label>
                <input id="companyName" required placeholder="Acme Ltd" />
              </div>
              <div class="form-group">
                <label data-translate-key="logoLabel" for="logoUpload">Logo</label>
                <input type="file" id="logoUpload" accept="image/*" />
              </div>
            </div>
            <div class="form-group">
              <label data-translate-key="addressLabel" for="companyAddress">Address</label>
              <textarea id="companyAddress" rows="2" placeholder="123 Main St\nCity"></textarea>
            </div>
            <div class="grid-2">
              <div class="form-group">
                <label data-translate-key="emailLabel" for="companyEmail">Email</label>
                <input type="email" id="companyEmail" placeholder="info@acme.com" />
              </div>
              <div class="form-group">
                <label data-translate-key="phoneLabel" for="companyPhone">Phone</label>
                <input id="companyPhone" placeholder="+1 555‚Äë1234" />
              </div>
            </div>
          </div>
        </details>

        <!-- Client -->
        <details class="form-block">
          <summary data-translate-key="clientSectionTitle">Client</summary>
          <div class="form-inner">
            <div class="form-group">
              <label data-translate-key="clientNameLabel" for="clientName">Client Name *</label>
              <input id="clientName" required placeholder="Client Co" />
            </div>
            <div class="form-group">
              <label data-translate-key="addressLabel" for="clientAddress">Address</label>
              <textarea id="clientAddress" rows="2"></textarea>
            </div>
            <div class="form-group">
              <label data-translate-key="emailLabel" for="clientEmail">Email</label>
              <input type="email" id="clientEmail" />
            </div>
          </div>
        </details>

        <!-- Invoice -->
        <details class="form-block">
          <summary data-translate-key="invoiceSectionTitle">Invoice</summary>
          <div class="form-inner">
            <div class="grid-2">
              <div class="form-group">
                <label data-translate-key="invoiceNumLabel" for="invoiceNumber">Invoice # *</label>
                <input id="invoiceNumber" required />
              </div>
              <div class="form-group">
                <label data-translate-key="currencyLabel" for="currency">Currency</label>
                <select id="currency"></select>
              </div>
              <div class="form-group">
                <label data-translate-key="invoiceDateLabel" for="invoiceDate">Date</label>
                <input type="date" id="invoiceDate" />
              </div>
              <div class="form-group">
                <label data-translate-key="dueDateLabel" for="dueDate">Due</label>
                <input type="date" id="dueDate" />
              </div>
            </div>
          </div>
        </details>

        <!-- Items -->
        <details class="form-block" open>
          <summary data-translate-key="itemsSectionTitle">Items</summary>
          <div class="form-inner">
            <div id="items-header">
              <label data-translate-key="itemDescLabel">Description</label>
              <label data-translate-key="itemQtyLabel">Qty</label>
              <label data-translate-key="itemRateLabel">Rate</label>
            </div>
            <div id="items-container"></div>
            <button type="button" class="btn-add-item" id="addItemBtn" data-translate-key="addItem">+ Add Item</button>
          </div>
        </details>

        <!-- Payment -->
        <details class="form-block">
          <summary data-translate-key="totalsSectionTitle">Payment & Notes</summary>
          <div class="form-inner">
            <div class="grid-2">
              <div class="form-group">
                <label data-translate-key="discountLabel" for="discount">Discount</label>
                <input id="discount" placeholder="10% or 50" />
              </div>
              <div class="form-group">
                <label data-translate-key="taxRateLabel" for="taxRate">Tax %</label>
                <input type="number" step="0.01" id="taxRate" />
              </div>
            </div>
            <div class="form-group">
              <label data-translate-key="paymentLinkLabel" for="paymentLink">Payment link</label>
              <input id="paymentLink" type="url" data-translate-key="paymentLinkPlaceholder" placeholder="https://example.com/pay" />
            </div>
            <div class="form-group">
              <label data-translate-key="notesLabel" for="notes">Notes</label>
              <textarea id="notes" rows="3"></textarea>
            </div>
          </div>
        </details>
      </form>
      <footer class="app-footer">¬© <span id="year"></span> ‚Ä¢ <a href="https://dee7studio.com" target="_blank">Dee7 Studio</a></footer>
    </aside>

    <!-- Preview -->
    <section class="panel panel-preview" id="panelPreview">
      <div class="preview-wrapper" id="previewContainer"></div>
    </section>
  </main>

  <!-- Script -->
  <script>
    (() => {
      /* ---------------- translations ---------------- */
      const translations = {
        en: { pageTitle: "Professional Invoice Generator", downloadPDF: "Download PDF", printPDF: "Print", companySectionTitle: "Your Company", companyNameLabel: "Company Name *", logoLabel: "Logo", addressLabel: "Address", emailLabel: "Email", phoneLabel: "Phone", clientSectionTitle: "Client", clientNameLabel: "Client Name *", invoiceSectionTitle: "Invoice", invoiceNumLabel: "Invoice # *", currencyLabel: "Currency", invoiceDateLabel: "Date", due
